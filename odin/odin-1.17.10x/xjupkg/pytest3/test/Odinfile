%all==%all-tests.tree:leaves

%all-tests.tree==<<
%test-that-passes
%test-that-fails

%test-that-passes==()+cmd=(%cmp.sh) (%test-that-passes.output) (%test-that-passes.output.expect):stdout

%test-that-passes.output==test1.py+env='TEST_PORT=9999':pytest3.output
%test-that-passes.output.expect==<<
starting some testing
output of run
.

%cmp.sh==! <<
#/bin/sh
cat "$1" | grep -v '1 passed in' | diff -b - "$2" >&2


%test-that-fails==(%test-that-fails.errors)+cmd=fgrep '"assert 1 == 2"':stdout

%test-that-fails.errors==(test-that-fails.py):pytest3.output:err
